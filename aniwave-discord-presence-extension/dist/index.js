(()=>{function u(){var o;return((o=document.getElementsByClassName("title d-title")[0])==null?void 0:o.innerText)??"Anime"}function d(){try{let e=document.getElementsByClassName("meta")[2].children[1].innerText.split(" ")[1],t=parseInt(e);if(!t)throw new Error("Duration not found");return t}catch{return 23}}function g(){var e,t;try{return((t=(e=document.getElementsByClassName("poster")[0])==null?void 0:e.children[0])==null?void 0:t.firstChild).src??"aniwave_image"}catch{return"aniwave_image"}}function p(){try{return url.split("/").at(-1).split("-").at(-1)}catch{return""}}function f(){var n;let t=((n=Array.from(document.querySelectorAll(".text-h6")).filter(o=>o.nodeName==="H1")[0])==null?void 0:n.innerText)??"Anime";return console.log(`Got title: ${t}`),t}function w(){var n;let e=Array.from(document.querySelectorAll(".text-overline")).filter(o=>o.innerText.includes("EPISODE"));if(e.length===0)return"Movie";let t=((n=e[0])==null?void 0:n.innerText.split(" ")[1])??"0";return console.log(`Got episode number: ${t}`),t}function A(){var l,m;let e=document.querySelectorAll(".v-image__image.v-image__image--cover"),t=Array.from(e).at(-1),n=(l=t==null?void 0:t.style)==null?void 0:l.cssText,o=(m=n==null?void 0:n.split('"'))==null?void 0:m.at(1);return o?(console.log(`Image URL: ${o}`),o):"aniwave_image"}function h(){return 23}var E=42069,y="http://localhost",T="/animeData",_=10*1e3,L=1e3,i="title",a="imageURL",s="episodeNumber",r="timeoutInMinutes",c=window.location.href,v={aniwave:{[i]:u,[a]:g,[s]:p,[r]:d},kickassanime:{[i]:f,[a]:A,[s]:w,[r]:h}};async function k(e){await new Promise(o=>setTimeout(o,_));let t=v[e],n={[i]:t[i](),[a]:t[a](),options:{[s]:t[s](),[r]:t[r](),buttonURL:c,buttonLabel:"Watch along!"}};return console.log({metadata:n}),n}async function b(e){let t=await fetch(`${y}:${E}${T}`,{method:"POST",body:e,headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Response not ok, status: ${t.status}`)}function D(e){return e.title&&e.imageURL}async function O(e){let t=await fetch(`${y}:${E}/log`,{method:"POST",body:JSON.stringify({message:e}),headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Response not ok, status: ${t.status}`)}function R(){let n=window.location.href.split("/").at(-1);return n!==""&&n.length>0}async function N(e){if(!R()){console.log("Not a content site, not sending to backend");return}let t=await k(e);if(!D(t)){console.log("Invalid payload, not sending to backend");return}let n=JSON.stringify(t);console.log(`Got: ${n}`),await b(n)}async function I(e){let t=c!==window.location.href,n=window.location.href.includes(e);t&&n&&(c=window.location.href,await N(e))}(async()=>{let e=c.split(".")[1];await O(`Website: ${e}`),await N(e),setInterval(async()=>await I(e),L)})();})();
//# sourceMappingURL=index.js.map
